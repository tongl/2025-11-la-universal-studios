<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Universal Studios Hollywood: Family Day Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&amp;display=swap"
        rel="stylesheet" />
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f3f4f6;
        }

        .hero-bg {
            background-color: #1e293b;
            position: relative;
            overflow: hidden;
        }

        .lot-badge {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 9999px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-lower {
            background-color: #ef4444;
            color: white;
        }

        .badge-upper {
            background-color: #3b82f6;
            color: white;
        }

        .scare-meter {
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            overflow: hidden;
        }

        .scare-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .details-content {
            transition: max-height 0.4s ease-out, opacity 0.4s ease-out, padding 0.3s ease;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .details-content.open {
            opacity: 1;
        }

        /* Check Button Styles */
        .check-btn {
            transition: all 0.2s ease;
            flex-shrink: 0;
            border-radius: 8px;
            /* Rounded rectangle */
        }

        .check-btn:hover {
            transform: scale(1.05);
            background-color: #f0fdf4;
        }

        .check-btn.active {
            background-color: #22c55e;
            color: white;
            border-color: #22c55e;
        }

        /* Done State Styles */
        .timeline-item.is-done {
            opacity: 0.6;
            filter: grayscale(0.8);
        }

        .timeline-item.is-done .check-btn {
            opacity: 1;
            /* Keep button visible */
        }
    </style>
</head>

<body class="text-slate-800">
    <!-- Hero Section -->
    <div class="hero-bg text-white shadow-xl">
        <div class="absolute inset-0 opacity-40">
            <!-- Background Image: Local Asset -->
            <img alt="Universal Studios Globe" class="w-full h-full object-cover" src="assets/header.jpg" />
        </div>
        <div class="relative z-10 container mx-auto px-4 py-12 lg:py-20 text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-4 drop-shadow-md">Hollywood Adventure</h1>
            <p class="text-xl md:text-2xl font-light mb-6">Family Itinerary ‚Ä¢ Nov 25, 2025</p>
            <div class="bg-white/10 backdrop-blur-md inline-block rounded-xl p-4 border border-white/20">
                <div class="flex items-center gap-6 text-left">
                    <div>
                        <div class="text-xs opacity-75 uppercase tracking-wider">Park Hours</div>
                        <div class="font-bold text-lg">9:00 AM - 8:00 PM</div>
                    </div>
                    <div class="h-8 w-px bg-white/30"></div>
                    <div>
                        <div class="text-xs opacity-75 uppercase tracking-wider">Ticket Type</div>
                        <div class="font-bold text-lg text-yellow-300">Universal Express</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Controls & Info -->
    <div class="container mx-auto px-4 -mt-8 relative z-20">
        <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4 w-full md:w-auto">
                <div class="bg-indigo-100 p-3 rounded-full text-indigo-600">
                    <span class="material-symbols-outlined text-2xl">child_care</span>
                </div>
                <div>
                    <h3 class="font-bold text-slate-800">Child Profile</h3>
                    <p class="text-sm text-slate-500">Age: 5 ‚Ä¢ Est. Height: 42-44"</p>
                </div>
            </div>
            <div
                class="flex items-center gap-3 bg-slate-50 px-4 py-2 rounded-lg border border-slate-200 w-full md:w-auto">
                <span class="material-symbols-outlined text-orange-500">height</span>
                <div class="flex-1">
                    <p class="text-xs font-bold text-slate-700">Strict Height Check</p>
                    <p class="text-[10px] text-slate-500">Highlight items &gt;40"</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input class="sr-only peer" id="heightToggle" type="checkbox" />
                    <div
                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-500">
                    </div>
                </label>
            </div>
        </div>
    </div>

    <!-- Map Section -->
    <div class="container mx-auto px-4 mt-6 relative z-10">
        <div class="bg-white rounded-xl shadow-lg p-2 border border-slate-200">
            <div class="rounded-lg overflow-hidden h-[600px] bg-slate-100 relative group">
                <img src="assets/park_map.png" alt="Universal Studios Hollywood Map"
                    class="w-full h-full object-cover object-center group-hover:scale-105 transition-transform duration-700">

                <!-- Map Labels -->
                <div
                    class="absolute top-[15%] left-[15%] bg-white/90 backdrop-blur px-2 py-1 rounded shadow-md border border-white/50 text-[10px] font-bold text-slate-800 hover:scale-110 transition-transform cursor-help">
                    üè∞ Wizarding World
                </div>
                <div
                    class="absolute bottom-[15%] right-[15%] bg-white/90 backdrop-blur px-2 py-1 rounded shadow-md border border-white/50 text-[10px] font-bold text-slate-800 hover:scale-110 transition-transform cursor-help">
                    üçÑ Super Nintendo World
                </div>
                <div
                    class="absolute bottom-[10%] left-[45%] bg-white/90 backdrop-blur px-2 py-1 rounded shadow-md border border-white/50 text-[10px] font-bold text-slate-800 hover:scale-110 transition-transform cursor-help">
                    ü¶ñ Jurassic World
                </div>
                <div
                    class="absolute top-[30%] right-[10%] bg-white/90 backdrop-blur px-2 py-1 rounded shadow-md border border-white/50 text-[10px] font-bold text-slate-800 hover:scale-110 transition-transform cursor-help">
                    üé¨ Studio Tour
                </div>
                <div
                    class="absolute top-[25%] left-[40%] bg-white/90 backdrop-blur px-2 py-1 rounded shadow-md border border-white/50 text-[10px] font-bold text-slate-800 hover:scale-110 transition-transform cursor-help">
                    üí¶ WaterWorld
                </div>

                <div
                    class="absolute bottom-4 right-4 bg-white/90 backdrop-blur px-3 py-1 rounded-lg text-xs font-bold text-slate-600 shadow-sm border border-white/50">
                    Static Map View
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="container mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-8 space-y-8">
            <!-- Morning -->
            <section>
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-yellow-100 text-yellow-700 p-2 rounded-lg"><span
                            class="material-symbols-outlined">wb_sunny</span></div>
                    <h2 class="text-2xl font-bold text-slate-800">Morning: The Lower Lot Strategy</h2>
                </div>
                <p class="text-sm text-slate-500 mb-6 bg-blue-50 p-3 rounded-lg border border-blue-100">
                    <span class="font-bold text-blue-600">Pro Tip:</span> Head straight to the Lower Lot upon entry. The
                    "Starway" escalators take ~20 mins round trip!
                </p>
                <div class="space-y-4" id="morning-timeline"></div>
            </section>
            <!-- Mid-Day -->
            <section>
                <div class="flex items-center gap-3 mb-4 mt-10">
                    <div class="bg-orange-100 text-orange-700 p-2 rounded-lg"><span
                            class="material-symbols-outlined">lunch_dining</span></div>
                    <h2 class="text-2xl font-bold text-slate-800">Mid-Day: Studio Tour & Lunch</h2>
                </div>
                <div class="space-y-4" id="midday-timeline"></div>
            </section>
            <!-- Afternoon -->
            <section>
                <div class="flex items-center gap-3 mb-4 mt-10">
                    <div class="bg-purple-100 text-purple-700 p-2 rounded-lg"><span
                            class="material-symbols-outlined">auto_awesome</span></div>
                    <h2 class="text-2xl font-bold text-slate-800">Afternoon: Wizarding World & Minions</h2>
                </div>
                <div class="space-y-4" id="afternoon-timeline"></div>
            </section>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-4 space-y-6">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden sticky top-6">
                <div class="p-4 bg-slate-800 text-white flex justify-between items-center">
                    <h3 class="font-bold">Park Layout</h3>
                    <span class="text-xs bg-white/20 px-2 py-1 rounded">2 Main Levels</span>
                </div>
                <div class="relative h-64 bg-slate-100">
                    <div class="absolute inset-0 flex flex-col p-4 gap-2">
                        <div
                            class="flex-1 bg-blue-50 border-2 border-blue-200 rounded-lg p-2 relative group hover:bg-blue-100 transition cursor-help">
                            <span class="absolute top-2 left-2 font-bold text-blue-800 text-xs uppercase">Upper
                                Lot</span>
                            <div class="absolute bottom-2 right-2 text-[10px] text-blue-600">Entry, Potter, Minions
                            </div>
                            <span
                                class="material-symbols-outlined absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-blue-300 text-4xl">castle</span>
                        </div>
                        <div class="h-8 flex items-center justify-center">
                            <div class="w-1 bg-slate-300 h-full mx-1"></div>
                            <span class="text-[10px] text-slate-400 font-mono">STARWAY</span>
                            <div class="w-1 bg-slate-300 h-full mx-1"></div>
                        </div>
                        <div
                            class="flex-1 bg-red-50 border-2 border-red-200 rounded-lg p-2 relative group hover:bg-red-100 transition cursor-help">
                            <span class="absolute top-2 left-2 font-bold text-red-800 text-xs uppercase">Lower
                                Lot</span>
                            <div class="absolute bottom-2 right-2 text-[10px] text-red-600">Nintendo, Jurassic</div>
                            <span
                                class="material-symbols-outlined absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-red-300 text-4xl">videogame_asset</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <h3 class="font-bold text-slate-800 mb-4">Dining Picks</h3>
                <div class="space-y-4">
                    <div class="flex gap-3">
                        <img alt="Toadstool Cafe" class="w-16 h-16 rounded-lg object-cover bg-slate-200"
                            src="assets/toadstool_cafe.jpg" />
                        <div>
                            <a href="https://www.google.com/maps/search/?api=1&query=Toadstool+Cafe+Universal+Studios+Hollywood"
                                target="_blank"
                                class="font-bold text-sm hover:text-indigo-600 hover:underline decoration-2 underline-offset-2 transition-colors block">Toadstool
                                Cafe</a>
                            <div class="flex items-center gap-1 mb-1">
                                <div
                                    class="flex items-center gap-0.5 text-[10px] font-bold text-amber-500 bg-amber-50 px-1 py-0.5 rounded border border-amber-100">
                                    <span class="material-symbols-outlined text-[10px]"
                                        style="font-variation-settings: 'FILL' 1;">star</span>
                                    <span>3.1</span>
                                </div>
                            </div>
                            <span
                                class="text-[10px] bg-red-100 text-red-600 px-1.5 py-0.5 rounded border border-red-200">Requires
                                Reservation</span>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <img alt="Three Broomsticks" class="w-16 h-16 rounded-lg object-cover bg-slate-200"
                            src="assets/broomsticks_interior.jpg" />
                        <div>
                            <a href="https://www.google.com/maps/search/?api=1&query=Three+Broomsticks+Universal+Studios+Hollywood"
                                target="_blank"
                                class="font-bold text-sm hover:text-indigo-600 hover:underline decoration-2 underline-offset-2 transition-colors block">Three
                                Broomsticks</a>
                            <div class="flex items-center gap-1 mb-1">
                                <div
                                    class="flex items-center gap-0.5 text-[10px] font-bold text-amber-500 bg-amber-50 px-1 py-0.5 rounded border border-amber-100">
                                    <span class="material-symbols-outlined text-[10px]"
                                        style="font-variation-settings: 'FILL' 1;">star</span>
                                    <span>4.6</span>
                                </div>
                            </div>
                            <span
                                class="text-[10px] bg-green-100 text-green-600 px-1.5 py-0.5 rounded border border-green-200">Great
                                for Families</span>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <img alt="Minion Cafe" class="w-16 h-16 rounded-lg object-cover bg-slate-200"
                            src="assets/minion_cafe.jpg" />
                        <div>
                            <a href="https://www.google.com/maps/search/?api=1&query=Minion+Cafe+Universal+Studios+Hollywood"
                                target="_blank"
                                class="font-bold text-sm hover:text-indigo-600 hover:underline decoration-2 underline-offset-2 transition-colors block">Minion
                                Cafe</a>
                            <div class="flex items-center gap-1 mb-1">
                                <div
                                    class="flex items-center gap-0.5 text-[10px] font-bold text-amber-500 bg-amber-50 px-1 py-0.5 rounded border border-amber-100">
                                    <span class="material-symbols-outlined text-[10px]"
                                        style="font-variation-settings: 'FILL' 1;">star</span>
                                    <span>3.4</span>
                                </div>
                            </div>
                            <span
                                class="text-[10px] bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded border border-yellow-200">Kid
                                Favorites</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <template id="item-template">
        <div
            class="timeline-item bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden group hover:border-indigo-200 transition-colors">
            <div class="p-4 flex gap-4 cursor-pointer item-header">
                <div class="w-16 h-16 shrink-0 relative">
                    <img alt="Ride" class="w-full h-full object-cover rounded-lg bg-slate-200 item-image" src="" />
                    <div class="absolute -bottom-2 -right-2 bg-white rounded-full p-1 shadow-sm">
                        <div
                            class="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white item-index-badge">
                            1</div>
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold text-lg text-slate-800 truncate item-title">Title</h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="lot-badge item-lot-badge">Upper Lot</span>
                                <span class="text-xs text-slate-500 flex items-center gap-1 item-time"><span
                                        class="material-symbols-outlined text-[14px]">schedule</span> <span
                                        class="item-duration">Duration</span></span>
                            </div>
                        </div>
                        <span
                            class="material-symbols-outlined text-slate-300 group-hover:text-indigo-500 transition-transform duration-300 arrow-icon">expand_more</span>
                    </div>
                    <div class="flex gap-2 mt-2 item-attributes"></div>
                </div>
            </div>
            <div class="details-content bg-slate-50 border-t border-slate-100">
                <div class="p-4">
                    <p class="text-sm text-slate-600 mb-4 item-desc">Description goes here.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white p-3 rounded-lg border border-slate-200">
                            <h4 class="text-xs font-bold uppercase text-slate-400 mb-2">Parents Guide</h4>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-xs font-semibold text-slate-600 w-24">Height Req:</span>
                                <span class="text-xs font-mono bg-slate-100 px-2 py-1 rounded item-height">40"</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-semibold text-slate-600 w-24">Scare Factor:</span>
                                <div class="flex-1">
                                    <div class="scare-meter">
                                        <div class="scare-fill bg-green-500 w-0 item-scare-fill"></div>
                                    </div>
                                    <p class="text-[10px] text-slate-400 mt-1 item-scare-text">None</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-indigo-50 p-3 rounded-lg border border-indigo-100">
                            <h4 class="text-xs font-bold uppercase text-indigo-400 mb-2">Express Tip</h4>
                            <p class="text-xs text-indigo-800 item-tip">Tip text.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <script>
        const itineraryData = {
            morning: [
                { id: 1, title: "Super Nintendo World", time: "9:15 AM", duration: "Exploration", lot: "Lower", image: "assets/nintendo_entry.jpg", desc: "Immerse yourself in the Mushroom Kingdom. Punch blocks, meet Mario & Luigi!", height: "None", scare: 0, scareText: "Pure Fun", tip: "Use Express Pass at Mario Kart entrance if land is busy.", tags: ["Must Do"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Super+Nintendo+World+Universal+Studios+Hollywood", rating: 4.8, expressWait: "15-20 min" },
                { id: 2, title: "Mario Kart: Bowser's Challenge", time: "9:45 AM", duration: "Ride", lot: "Lower", image: "assets/mario_kart.jpg", desc: "Battle Team Bowser in this AR racing ride.", height: "40\"", scare: 1, scareText: "Mild Spins", tip: "Tap band on steering wheel.", tags: ["Top Tier"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Mario+Kart+Bowser's+Challenge+Universal+Studios+Hollywood", rating: 4.7, expressWait: "20-30 min" },
                { id: 3, title: "Toadstool Cafe", time: "10:45 AM", duration: "Dining", lot: "Lower", image: "assets/toadstool_cafe.jpg", desc: "Chef Toad's cooking. Try the Super Mushroom Soup!", height: "None", scare: 0, scareText: "Yummy", tip: "Join waitlist at 7AM sharp.", tags: ["Food"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Toadstool+Cafe+Universal+Studios+Hollywood", rating: 4.2, expressWait: "N/A" },
                { id: 4, title: "Jurassic World: The Ride", time: "11:45 AM", duration: "Ride", lot: "Lower", image: "assets/jurassic.jpg", desc: "Face the Indominus Rex on this water ride.", height: "42\"", scare: 6, scareText: "Big Drop", tip: "Sit in back to stay drier.", tags: ["Water"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Jurassic+World+The+Ride+Universal+Studios+Hollywood", rating: 4.6, expressWait: "10-15 min" },
                { id: 5, title: "Revenge of the Mummy", time: "12:30 PM", duration: "Ride", lot: "Lower", image: "assets/header.jpg", desc: "High-speed indoor coaster in the dark.", height: "48\"", scare: 7, scareText: "Fast/Dark", tip: "Free lockers available.", tags: ["Thrill"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Revenge+of+the+Mummy+The+Ride+Universal+Studios+Hollywood", rating: 4.5, expressWait: "5-10 min" }
            ],
            midday: [
                { id: 6, title: "Studio Tour", time: "1:30 PM", duration: "Tour", lot: "Upper", image: "assets/studio_tour.jpg", desc: "The world-famous backlot tour.", height: "None", scare: 2, scareText: "Mild", tip: "Sit on left side for best views.", tags: ["Iconic"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Universal+Studios+Tour+Hollywood", rating: 4.9, expressWait: "10-15 min" },
                { id: 7, title: "Lunch: Three Broomsticks", time: "2:45 PM", duration: "Dining", lot: "Upper", image: "assets/broomsticks_food.jpg", desc: "Rustic tavern fare: Fish & Chips and Butterbeer.", height: "None", scare: 0, scareText: "Yummy", tip: "Mobile Order via App.", tags: ["Food"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Three+Broomsticks+Universal+Studios+Hollywood", rating: 4.6, expressWait: "N/A" }
            ],
            afternoon: [
                { id: 8, title: "Wizarding World: Hippogriff", time: "4:00 PM", duration: "Ride", lot: "Upper", image: "assets/hippogriff.jpg", desc: "Family-friendly coaster.", height: "39\"", scare: 3, scareText: "Mild Coaster", tip: "Perfect first coaster.", tags: ["Fun"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Flight+of+the+Hippogriff+Universal+Studios+Hollywood", rating: 4.6, expressWait: "5-10 min" },
                { id: 9, title: "Secret Life of Pets", time: "4:45 PM", duration: "Ride", lot: "Upper", image: "assets/pets_ride.jpg", desc: "Transform into a puppy and travel through NYC.", height: "34\"", scare: 0, scareText: "None", tip: "Absolute MUST DO.", tags: ["Must Do"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=The+Secret+Life+of+Pets+Off+the+Leash+Universal+Studios+Hollywood", rating: 4.6, expressWait: "15-20 min" },
                { id: 10, title: "Super Silly Fun Land", time: "5:30 PM", duration: "Play/Ride", lot: "Upper", image: "assets/fun_land.jpg", desc: "Minion-themed carnival area.", height: "None", scare: 0, scareText: "Playground", tip: "Great spot to burn energy.", tags: ["Kids"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=Super+Silly+Fun+Land+Universal+Studios+Hollywood", rating: 4.6, expressWait: "N/A" },
                { id: 11, title: "WaterWorld", time: "6:15 PM", duration: "Show", lot: "Upper", image: "assets/waterworld.jpg", desc: "World-class stunt show.", height: "None", scare: 5, scareText: "Loud Explosions", tip: "Arrive 20 mins early.", tags: ["Show"], mapsUrl: "https://www.google.com/maps/search/?api=1&query=WaterWorld+Universal+Studios+Hollywood", rating: 4.8, expressWait: "N/A" }
            ]
        };

        // State Management
        const doneState = JSON.parse(localStorage.getItem('ush_done_state')) || [];

        function toggleDone(id, btn) {
            const item = btn.closest('.timeline-item');
            const index = doneState.indexOf(id);

            if (index === -1) {
                doneState.push(id);
                item.classList.add('is-done');
                btn.classList.add('active');
                btn.innerHTML = '<span class="material-symbols-outlined text-lg">check</span>';
            } else {
                doneState.splice(index, 1);
                item.classList.remove('is-done');
                btn.classList.remove('active');
                btn.innerHTML = '';
            }

            localStorage.setItem('ush_done_state', JSON.stringify(doneState));
        }

        function renderTimeline(sectionId, items) {
            const container = document.getElementById(sectionId);
            const template = document.getElementById('item-template');

            items.forEach(item => {
                const clone = template.content.cloneNode(true);
                const el = clone.querySelector('.timeline-item');
                const header = clone.querySelector('.item-header');
                const isDone = doneState.includes(item.id);

                if (isDone) {
                    el.classList.add('is-done');
                }

                // Create and insert Check Button at the start of header
                const checkBtn = document.createElement('button');
                checkBtn.className = `check-btn w-8 h-8 rounded-lg border-2 border-slate-300 flex items-center justify-center text-slate-400 self-center mr-1 ${isDone ? 'active' : ''}`;
                checkBtn.innerHTML = isDone ? '<span class="material-symbols-outlined text-lg">check</span>' : '';
                checkBtn.onclick = (e) => {
                    e.stopPropagation(); // Prevent accordion toggle
                    toggleDone(item.id, checkBtn);
                };
                header.insertBefore(checkBtn, header.firstChild);

                // Title with Link and Rating
                const titleEl = clone.querySelector('.item-title');

                // Reset title element classes (remove flex container logic from previous step)
                titleEl.classList.remove('flex', 'items-center', 'justify-between', 'gap-2');
                titleEl.classList.add('truncate'); // Restore truncate

                titleEl.innerHTML = `
                    <a href="${item.mapsUrl}" target="_blank" class="hover:text-indigo-600 hover:underline decoration-2 underline-offset-2 transition-colors flex items-center gap-2 truncate">
                        ${item.title}
                    </a>
                `;

                // Add rating below title
                const ratingDiv = document.createElement('div');
                ratingDiv.className = 'flex items-center gap-1 mt-1';
                ratingDiv.innerHTML = `
                    <div class="flex items-center gap-0.5 text-xs font-bold text-amber-500 bg-amber-50 px-1.5 py-0.5 rounded border border-amber-100">
                        <span class="material-symbols-outlined text-[14px]" style="font-variation-settings: 'FILL' 1;">star</span>
                        <span>${item.rating}</span>
                    </div>
                `;
                titleEl.parentNode.insertBefore(ratingDiv, titleEl.nextSibling);


                clone.querySelector('.item-duration').textContent = item.duration;
                clone.querySelector('.item-image').src = item.image;
                clone.querySelector('.item-desc').textContent = item.desc;
                clone.querySelector('.item-height').textContent = item.height;
                clone.querySelector('.item-tip').textContent = item.tip;
                clone.querySelector('.item-scare-text').textContent = item.scareText;
                clone.querySelector('.item-index-badge').textContent = item.id;

                const lotBadge = clone.querySelector('.item-lot-badge');
                lotBadge.textContent = item.lot + (item.lot === 'Connector' ? '' : ' Lot');
                if (item.lot === 'Lower') lotBadge.classList.add('badge-lower');
                else if (item.lot === 'Upper') lotBadge.classList.add('badge-upper');
                else lotBadge.classList.add('bg-slate-500', 'text-white');

                const tagContainer = clone.querySelector('.item-attributes');
                item.tags.forEach(tag => {
                    const span = document.createElement('span');
                    span.className = "text-[10px] px-2 py-1 rounded bg-slate-100 text-slate-600 font-semibold border border-slate-200";
                    span.textContent = tag;
                    tagContainer.appendChild(span);
                });

                // Express Wait Badge
                if (item.expressWait && item.expressWait !== "N/A") {
                    const expressSpan = document.createElement('span');
                    expressSpan.className = "text-[10px] px-2 py-1 rounded bg-purple-100 text-purple-700 font-bold border border-purple-200 flex items-center gap-1";
                    expressSpan.innerHTML = `<span class="material-symbols-outlined text-[12px]">bolt</span> Express: ${item.expressWait}`;
                    tagContainer.appendChild(expressSpan);
                }

                const scareFill = clone.querySelector('.item-scare-fill');
                scareFill.style.width = `${item.scare * 10}%`;
                if (item.scare > 6) scareFill.classList.replace('bg-green-500', 'bg-red-500');
                else if (item.scare > 3) scareFill.classList.replace('bg-green-500', 'bg-yellow-500');

                if (item.height.includes('40') || item.height.includes('42') || item.height.includes('48')) {
                    el.dataset.heightRestricted = "true";
                }

                const content = clone.querySelector('.details-content');
                const arrow = clone.querySelector('.arrow-icon');

                // Prevent link click from toggling accordion
                titleEl.querySelector('a').addEventListener('click', (e) => {
                    e.stopPropagation();
                });

                header.addEventListener('click', () => {
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        content.classList.remove('open');
                        arrow.style.transform = 'rotate(0deg)';
                        header.classList.remove('bg-indigo-50');
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        content.classList.add('open');
                        arrow.style.transform = 'rotate(180deg)';
                        header.classList.add('bg-indigo-50');
                    }
                });

                container.appendChild(clone);
            });
        }

        renderTimeline('morning-timeline', itineraryData.morning);
        renderTimeline('midday-timeline', itineraryData.midday);
        renderTimeline('afternoon-timeline', itineraryData.afternoon);

        document.getElementById('heightToggle').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            document.querySelectorAll('.timeline-item').forEach(item => {
                if (item.dataset.heightRestricted === "true") {
                    if (isChecked) {
                        item.classList.add('ring-2', 'ring-orange-400', 'bg-orange-50');
                        item.querySelector('.item-height').classList.add('bg-orange-200', 'text-orange-800');
                    } else {
                        item.classList.remove('ring-2', 'ring-orange-400', 'bg-orange-50');
                        item.querySelector('.item-height').classList.remove('bg-orange-200', 'text-orange-800');
                    }
                }
            });
        });
    </script>
</body>

</html>